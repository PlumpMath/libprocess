# Makefile.

SHELL = '/bin/sh'

CXX = @CXX@

CXXFLAGS = @CXXFLAGS@

# Add . to CXXFLAGS.
CXXFLAGS += -I@abs_srcdir@

# Add libev to CXXFLAGS.
CXXFLAGS += -I@abs_srcdir@/third_party/libev-3.8

# Add Boost to CXXFLAGS.
CXXFLAGS += -I@abs_srcdir@/third_party/boost-1.37.0

# Add -fPIC to CXXFLAGS.
CXXFLAGS += -fPIC

# Add dependency tracking to CXXFLAGS.
CXXFLAGS += -MMD -MP

LIB_OBJ = process.o tuple.o record-process.o serialization.o
LIB = libprocess.a

default: all

-include $(patsubst %.o, %.d, $(LIB_OBJ))

$(LIB_OBJ): %.o: @abs_srcdir@/%.cpp 
	$(CXX) -c $(CXXFLAGS) -o $@ $<

$(LIB): $(LIB_OBJ)
	$(AR) rcs $@ $^

third_party:
	$(MAKE) -C @abs_builddir@/third_party/libev-3.8

all: third_party $(LIB)

clean:
	$(MAKE) -C @abs_builddir@/third_party/libev-3.8 clean
	rm -f $(patsubst %.o, %.d, $(LIB_OBJ)) $(LIB_OBJ) $(LIB)

distclean: clean
	$(MAKE) -C @abs_builddir@/third_party/libev-3.8 dist clean
	rm -f config.status config.cache config.log
	rm -f Makefile

.PHONY: default third_party all clean